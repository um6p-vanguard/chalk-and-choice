{% extends "base.html" %}
{% block content %}
<div class="card">
  <div class="row" style="justify-content:space-between; align-items:flex-start;">
    <div>
      <h3 style="margin:0;">Student attempts — {{ project.title }}</h3>
      {% if project.description %}<p class="muted" style="margin:6px 0;">{{ project.description }}</p>{% endif %}
      <p class="muted" style="margin:6px 0;">{{ project.tasks|length }} task(s) • Code: <code>{{ project.code }}</code></p>
    </div>
    <div class="row" style="gap:8px;">
      <a class="btn" href="{{ url_for('projects_show', code=project.code) }}">Back to project</a>
      <a class="btn" href="{{ url_for('projects_reviews') }}">Mentor reviews</a>
    </div>
  </div>
  <p class="muted" style="margin-top:6px; font-size:0.95rem;">See every student's attempt for this project, with quick links into per-task responses.</p>
</div>
<div class="sp"></div>
<div class="card">
  {% if student_rows %}
    <table style="margin-top:4px;">
      <thead>
        <tr>
          <th>Student</th>
          <th>Progress</th>
          <th>Statuses</th>
          <th>Last activity</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for row in student_rows %}
          <tr>
            <td>
              <div><strong>{{ row.student_name }}</strong></div>
              <div class="muted" style="font-size:0.9rem;">{{ row.student_email or "No email on file" }}</div>
            </td>
            <td>
              <div>{{ row.completed_count }} / {{ row.total_tasks }} tasks submitted</div>
              <div class="muted" style="font-size:0.9rem;">Attempted {{ row.attempted_count }} task(s)</div>
            </td>
            <td>
              <div class="muted" style="font-size:0.9rem;">
                Accepted: <strong>{{ row.accepted_count }}</strong> • Pending review: <strong>{{ row.pending_count }}</strong> • In progress: <strong>{{ row.in_progress_count }}</strong>
              </div>
            </td>
            <td>
              {{ row.last_activity.strftime("%b %d %H:%M") if row.last_activity else "—" }}
            </td>
            <td style="text-align:right;">
              {% if row.student_id %}
                <a class="btn btn-primary" href="{{ url_for('projects_student_submissions', code=project.code, student_id=row.student_id) }}">View attempt</a>
              {% else %}
                <span class="muted">No student profile</span>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p class="muted" style="margin:0;">No submissions for this project yet.</p>
  {% endif %}
</div>
{% endblock %}
