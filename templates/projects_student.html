{% extends "base.html" %}
{% block content %}
<div class="card">
  <h3 style="margin:0;">Projects</h3>
  <p class="muted" style="margin-top:6px;">Complete tasks in order. Locked projects require finishing prerequisite projects first.</p>
</div>
<div class="sp"></div>
{% if projects %}
  {% for row in projects %}
    <div class="card" style="margin-bottom:16px;">
      <div class="row" style="justify-content:space-between; align-items:center;">
        <div>
          <h3 style="margin:0;">{{ row.project.title }}</h3>
          {% if row.project.description %}<p class="muted" style="margin:4px 0;">{{ row.project.description }}</p>{% endif %}
          <p class="muted" style="margin:4px 0;">
            {% if row.unlocked %}
              {% if row.completed %}
                <span style="color:#4ade80;">Completed</span>
              {% else %}
                <span style="color:#fde047;">In progress</span>
              {% endif %}
            {% else %}
              <span style="color:#f87171;">Locked â€” finish prerequisites.</span>
            {% endif %}
          </p>
        </div>
        {% if row.unlocked and row.tasks %}
          <div class="muted">{{ row.completed_count }} / {{ row.total_tasks }} tasks done</div>
        {% endif %}
      </div>
      {% if row.project.instructions %}
        <div style="margin-top:10px; padding:10px; border:1px dashed #334155; border-radius:10px;">
          <strong>Instructions</strong>
          <p class="muted" style="margin:6px 0 0 0; white-space:pre-line;">{{ row.project.instructions }}</p>
        </div>
      {% endif %}
      {% if row.tasks %}
        <table style="margin-top:12px;">
          <thead>
            <tr>
              <th>Task</th>
              <th>Status</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% for entry in row.tasks %}
            <tr>
              <td>{{ entry.task.title }}</td>
              <td>
                {% if entry.status == "accepted" %}
                  <span style="color:#4ade80;">Accepted</span>
                {% elif entry.status == "submitted" %}
                  <span style="color:#4ade80;">Completed</span>
                {% elif entry.status == "pending_review" %}
                  <span style="color:#fde047;">Pending mentor review</span>
                {% elif entry.status == "in_progress" %}
                  <span class="muted">In progress</span>
                {% elif entry.status == "rejected" %}
                  <span style="color:#f87171;">Needs rework</span>
                  {% if entry.submission and entry.submission.review_notes %}
                    <div class="muted" style="margin-top:4px;">{{ entry.submission.review_notes }}</div>
                  {% endif %}
                {% else %}
                  <span class="muted">Not started</span>
                {% endif %}
              </td>
              <td>
                {% if row.unlocked %}
                  <a class="btn btn-primary" href="{{ url_for('project_task_take', code=row.project.code, task_id=entry.task.id) }}">Open</a>
                {% else %}
                  <span class="muted">Locked</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p class="muted" style="margin-top:10px;">No tasks configured yet.</p>
      {% endif %}
    </div>
  {% endfor %}
{% else %}
  <div class="card">
    <p class="muted">No projects are available right now.</p>
  </div>
{% endif %}
{% endblock %}
