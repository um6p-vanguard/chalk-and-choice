{% extends "base.html" %}
{% import "_task_answers.html" as task_answers %}
{% block content %}
<div class="card">
  <div class="row" style="justify-content:space-between; align-items:flex-start;">
    <div>
      <h3 style="margin:0;">{{ project.title if project else "Project" }} — {{ task.title if task else "Task" }}</h3>
      <p class="muted" style="margin-top:4px;">Student: {{ submission.student_name or "Unknown" }}</p>
      <p class="muted" style="margin-top:4px;">Submitted: {{ submission.submitted_at.strftime("%b %d %H:%M") if submission.submitted_at else "—" }}</p>
    </div>
    <div class="row" style="gap:8px;">
      <a class="btn" href="{{ url_for('projects_reviews') }}">Back to review list</a>
      {% if submission.student_id %}
        <a class="btn" href="{{ url_for('projects_submission_task_detail', code=project.code, student_id=submission.student_id, task_id=task.id) }}">Open task view</a>
      {% endif %}
    </div>
  </div>
</div>
<div class="sp"></div>
<div class="card">
  {{ task_answers.render(questions, answers, logs_by_question, grading_by_question=grading_by_question, show_meta=True, task_auto_grade=(task.auto_grade if task else True), code_runs_enabled=code_runs_enabled, submission_id=submission.id) }}
</div>
<div class="sp"></div>
<div class="card">
  <h3 style="margin:0 0 16px 0;">Review Decision</h3>
  <form method="post" action="{{ url_for('projects_review_decision', submission_id=submission.id) }}">
    <input type="hidden" name="csrf" value="{{ csrf_token() }}">
    <div style="margin-bottom:16px;">
      <label style="display:block; margin-bottom:6px; font-weight:500;">Reviewer Notes (optional)</label>
      <textarea name="review_notes" rows="4" placeholder="Add feedback for the student..." style="width:100%; min-height:100px; padding:10px; border:1px solid #334155; border-radius:8px; background:#0f172a; color:#e2e8f0; font-family:inherit; font-size:0.95rem;">{{ submission.review_notes or "" }}</textarea>
    </div>
    <div class="row" style="gap:10px; flex-wrap:wrap;">
      <button class="btn" type="submit" name="action" value="accept" style="background:#10b981; color:#fff; border:none; padding:10px 20px; font-weight:500; font-size:0.95rem; min-width:120px;">✓ Accept</button>
      <button class="btn" type="submit" name="action" value="need_rework" style="background:#f59e0b; color:#fff; border:none; padding:10px 20px; font-weight:500; font-size:0.95rem; min-width:140px;">↻ Need Rework</button>
      <button class="btn" type="submit" name="action" value="reject" style="background:#ef4444; color:#fff; border:none; padding:10px 20px; font-weight:500; font-size:0.95rem; min-width:120px;">✕ Reject</button>
    </div>
  </form>
</div>
{% endblock %}
