{% extends "base.html" %}
{% block content %}
<div class="card">
  <div class="row" style="justify-content:space-between; align-items:center;">
    <div>
      <h2 style="margin:0;">Learning Outcomes</h2>
      <p class="muted" style="margin-top:4px;">Define the skills students must master</p>
    </div>
    <div class="row" style="gap:8px;">
      <a href="{{ url_for('proficiency_config') }}" class="btn">⚙️ Settings</a>
      <a href="{{ url_for('proficiency_exercises_list') }}" class="btn">Exercises</a>
      <a href="{{ url_for('proficiency_outcomes_new') }}" class="btn btn-primary">+ New Outcome</a>
    </div>
  </div>
</div>

<div class="sp"></div>

{% for domain_key, domain_info in by_domain.items() %}
<div class="card">
  <h3>{{ domain_info.display }}</h3>
  <p class="muted">{{ domain_info.outcomes|length }} outcome(s)</p>
  
  {% if domain_info.outcomes %}
  <table style="margin-top:16px;">
    <thead>
      <tr>
        <th>Outcome</th>
        <th>Tag</th>
        <th>Difficulty</th>
        <th>Exercises</th>
        <th>Duration</th>
        <th>Status</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for outcome in domain_info.outcomes %}
      <tr>
        <td>
          <div>{{ outcome.icon_emoji }} {{ outcome.display_name }}</div>
          {% if outcome.description %}
          <div class="muted" style="font-size:0.9rem; margin-top:4px;">{{ outcome.description }}</div>
          {% endif %}
          {% if outcome.prerequisites %}
          <div class="muted" style="font-size:0.85rem; margin-top:4px;">
            Prerequisites: {{ outcome.prerequisites|join(', ') }}
          </div>
          {% endif %}
        </td>
        <td><code style="background:var(--bg); padding:4px 8px; border-radius:4px;">{{ outcome.tag_name }}</code></td>
        <td>
          {% if outcome.difficulty_level == 1 %}⭐ Basic
          {% elif outcome.difficulty_level == 2 %}⭐⭐ Intermediate
          {% elif outcome.difficulty_level == 3 %}⭐⭐⭐ Advanced
          {% endif %}
        </td>
        <td>{{ outcome.exercise_count }}</td>
        <td>{{ outcome.duration_minutes }}m</td>
        <td>
          {% if outcome.is_active %}
          <span style="color:#4ade80;">✓ Active</span>
          {% else %}
          <span class="muted">Inactive</span>
          {% endif %}
        </td>
        <td>
          <div class="row" style="gap:6px;">
            <a href="{{ url_for('proficiency_outcomes_edit', outcome_id=outcome.id) }}" class="btn">Edit</a>
            <form method="POST" action="{{ url_for('proficiency_outcomes_delete', outcome_id=outcome.id) }}" 
                  onsubmit="return confirm('Delete this outcome? This cannot be undone.');" style="margin:0;">
              <input type="hidden" name="csrf" value="{{ csrf_token() }}">
              <button type="submit" class="btn btn-danger">Delete</button>
            </form>
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% endif %}
</div>
<div class="sp"></div>
{% endfor %}

{% if not by_domain %}
<div class="card">
  <p class="muted" style="margin:0;">No learning outcomes yet. Create one to get started!</p>
</div>
{% endif %}

{% endblock %}
