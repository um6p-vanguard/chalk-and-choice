{% extends "base.html" %}
{% import "_task_answers.html" as task_answers %}
{% block content %}
<div class="card">
  <div class="row" style="justify-content:space-between; align-items:flex-start;">
    <div>
      <h3 style="margin:0;">{{ task.title }}</h3>
      <p class="muted" style="margin:4px 0;">Project: {{ project.title }} ({{ project.code }})</p>
      <p class="muted" style="margin:4px 0;">Student: {{ student.name or "Unknown" }} — {{ student.email or "No email" }}</p>
      <p class="muted" style="margin:4px 0;">Status:
        {% if submission.status == "accepted" %}
          <span style="color:#4ade80;">Accepted</span>
        {% elif submission.status == "pending_review" %}
          <span style="color:#fde047;">Pending review</span>
        {% elif submission.status == "rejected" %}
          <span style="color:#f87171;">Needs rework</span>
        {% elif submission.status == "submitted" %}
          <span style="color:#38bdf8;">Submitted</span>
        {% else %}
          <span class="muted">In progress</span>
        {% endif %}
      </p>
      <p class="muted" style="margin:4px 0;">
        Submitted: {{ submission.submitted_at.strftime("%b %d %H:%M") if submission.submitted_at else "—" }} •
        Last activity: {{ submission.last_activity_at.strftime("%b %d %H:%M") if submission.last_activity_at else "—" }}
      </p>
      {% if submission.review_notes %}
        <div style="margin-top:6px; padding:10px; border:1px dashed #334155; border-radius:10px;">
          <strong>Reviewer notes</strong>
          <p class="muted" style="margin:6px 0 0 0; white-space:pre-line;">{{ submission.review_notes }}</p>
        </div>
      {% endif %}
    </div>
    {% if user %}
      <div class="row" style="gap:8px;">
        <a class="btn" href="{{ url_for('projects_student_submissions', code=project.code, student_id=student.id) }}">Back to tasks</a>
        <a class="btn" href="{{ url_for('projects_submissions_overview', code=project.code) }}">All attempts</a>
      </div>
    {% else %}
      <div class="row" style="gap:8px;">
        <a class="btn" href="{{ url_for('student_projects') }}">Back to projects</a>
      </div>
    {% endif %}
  </div>
</div>
<div class="sp"></div>
<div class="card">
  <h3 style="margin-top:0;">Student responses</h3>
  {{ task_answers.render(questions, answers, logs_by_question, submission_id=submission.id) }}
</div>
{% endblock %}
